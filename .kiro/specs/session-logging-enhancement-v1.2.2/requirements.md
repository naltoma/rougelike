# Requirements Document

## Introduction

v1.2.2では、セッションログ機能の調査・修正・改善を行います。現在のシステムではinitialize_api()が実行されているにも関わらず、デフォルトでのログ生成状況が不明確であり、ログの確認方法も明確ではありません。本機能により、教育現場での学習データ収集を確実に行い、教員および学生が学習進捗を適切に追跡できるようになります。

## Requirements

### Requirement 1: セッションログ生成状況の調査と診断

**User Story:** システム管理者として、現在のセッションログ生成状況を正確に把握したいので、ログ機能の動作状況を確認できる診断機能が必要です。

#### Acceptance Criteria

1. WHEN システムが起動される THEN システムは現在のログ設定状況をコンソールに表示する
2. WHEN initialize_api()が呼び出される THEN システムはSessionLogManagerの初期化状況をログに記録する  
3. IF セッションログが無効化されている THEN システムは警告メッセージを表示し、有効化方法を案内する
4. WHEN ゲームセッションが開始される THEN システムはログファイルの作成状況を確認し、結果を報告する
5. WHERE ログディレクトリが存在しない場合 THE システムはディレクトリを自動作成し、作成結果をログに記録する

### Requirement 2: デフォルトログ生成の設定と有効化

**User Story:** 学生として、特別な設定を行わなくても自動的に学習ログが記録されるので、学習進捗を後から確認することができます。

#### Acceptance Criteria

1. WHEN main.pyが実行される THEN システムは常にデフォルトでセッションログを有効化する
2. IF 学生IDが設定されていない THEN システムはデフォルト学生ID（例：DEFAULT_USER）を使用してログを生成する
3. WHEN ゲームセッションが終了する THEN システムは自動的にセッション終了ログを保存する
4. WHILE ゲームが実行中の間 THE システムは全てのアクション（move, turn_left, turn_right, attack, pickup）をログに記録する
5. WHERE エラーが発生した場合 THE システムはエラー内容をログファイルに記録し、処理を継続する

### Requirement 3: ログファイルアクセスと参照方法の改善

**User Story:** 教員として、学生の学習ログを簡単にアクセス・確認できるので、個別指導や進捗評価を効率的に行うことができます。

#### Acceptance Criteria

1. WHEN システムが起動される THEN システムは現在保存されているログファイルの場所をコンソールに表示する
2. IF ログファイルが存在する THEN システムは最新のログファイルパスを明示的に表示する
3. WHEN show_log_info()関数が呼び出される THEN システムは利用可能なログファイル一覧と各ファイルの詳細情報を表示する
4. WHERE 複数のログファイルが存在する場合 THE システムは日時順でソートして表示する
5. WHEN ログファイルが読み込まれる THEN システムは内容をフォーマットして読みやすい形式で表示する

### Requirement 4: ログ機能のテストとバリデーション

**User Story:** 開発者として、ログ機能が正常に動作することを確認したいので、包括的なテスト機能が必要です。

#### Acceptance Criteria

1. WHEN test_session_logging()が実行される THEN システムはセッションログの全機能をテストし、結果を報告する
2. IF ログ書き込みに失敗した場合 THEN システムはエラーを検出し、代替保存場所を試行する
3. WHEN ログファイルの整合性チェックが実行される THEN システムは各ログエントリのフォーマットとデータ完整性を検証する
4. WHERE 権限エラーが発生した場合 THE システムはユーザーフレンドリーなエラーメッセージを表示し、解決方法を提案する
5. WHEN システムが異常終了した場合 THEN システムは次回起動時に未保存のログデータを復旧する

### Requirement 5: ログ設定の管理とカスタマイズ

**User Story:** 教員として、クラスの要件に応じてログ設定をカスタマイズできるので、教育目標に合わせたデータ収集を行うことができます。

#### Acceptance Criteria

1. WHEN configure_logging()が呼び出される THEN システムはログレベル、出力先、フォーマットを設定できる
2. IF 環境変数LOGGING_LEVELが設定されている THEN システムは指定されたレベルでログを出力する
3. WHEN ログファイルサイズが上限に達する THEN システムは自動的にローテーションを実行し、古いファイルを保持する
4. WHERE Google Sheets連携が有効な場合 THE システムはローカルログとクラウドログの同期状態を管理する
5. WHEN ログ設定が変更される THEN システムは設定変更をログに記録し、次回起動時に適用する