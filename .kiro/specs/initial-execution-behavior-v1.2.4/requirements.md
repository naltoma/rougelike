# Requirements Document

## 概要

v1.2.4では、Python初学者向けローグライク演習フレームワークの初回起動時動作を改善し、学生がより自然で効果的な学習フローを体験できる機能を実装します。現在の実装では、学生がステージを選択して実行すると即座にコード実行モードに入りますが、これを改善して、まずステージの理解フェーズを経てから実装フェーズに移行するよう動作を変更します。

この機能により、学生は「ステージ理解 → コード記述 → 実行確認」という教育的に望ましい学習フローを自然に体験できるようになります。

## Requirements

### Requirement 1: 初回確認モードフラグ管理機能
**ユーザーストーリー:** 学習者として、新しいステージに初めて取り組む際に、まずステージの内容と条件を確認してから実装を開始したい。そうすることで、問題を理解してから解決策を考えるという自然な学習フローを体験できる。

#### 受入条件
1. WHEN システムが初期起動される THEN システムは初回確認モードフラグを False として設定する
2. WHEN 学習者が solve()関数に実装コードを記述して動作確認したい場合 THEN 学習者はフラグを True に変更してから実行する  
3. IF 初回確認モードフラグが True に設定されている THEN システムは従来のデフォルト動作で実行する
4. WHEN フラグの状態が変更される THEN システムは変更されたフラグ状態を即座に反映する

### Requirement 2: ステージ条件表示機能
**ユーザーストーリー:** 学習者として、初回確認モードでステージを実行した際に、そのステージのクリア条件や目標を明確に知りたい。そうすることで、何を達成すべきかを理解してからコード記述に取り組める。

#### 受入条件
1. WHEN 初回確認モードフラグが False の状態でステージが実行される THEN システムはステージ画面を通常通り描画する
2. WHEN 初回確認モードでのステージ実行が完了する THEN システムはステージのクリア条件をターミナルに出力する
3. IF ステージファイルにdescription項目が存在する THEN システムはその内容をクリア条件として表示する
4. IF ステージファイルにdescription項目が存在しない THEN システムは「クリア条件：詳細な条件はステージファイルを確認してください」と表示する
5. WHEN クリア条件が表示される THEN システムは学習者が条件を読むのに十分な形で情報を整理して出力する

### Requirement 3: セッションログ除外機能  
**ユーザーストーリー:** 教員として、学生の初回確認モードでの活動は試行回数や学習データとしてカウントされないようにしたい。そうすることで、純粋な学習活動と実際の取り組み活動を区別して分析できる。

#### 受入条件
1. WHEN 初回確認モードフラグが False の状態でアプリケーションが終了される THEN システムはセッションログを生成しない
2. WHEN 初回確認モードで Exit ボタンが押される THEN システムは試行回数をカウントしない
3. WHEN 初回確認モードで任意の終了操作が実行される THEN システムはaction_count等の学習データを記録しない
4. IF 通常実行モード（フラグ True）でアプリケーションが終了される THEN システムは従来通りセッションログを生成する
5. WHEN セッションログ除外処理が実行される THEN システムはデータファイルやアップロード処理を一切実行しない

### Requirement 4: モード遷移制御機能
**ユーザーストーリー:** 学習者として、ステージ条件を確認した後、スムーズに実装モードに切り替えてコード記述を開始したい。そうすることで、理解から実装への流れを中断することなく学習を継続できる。

#### 受入条件  
1. WHEN 学習者が初回確認モードから実装モードに移行したい場合 THEN 学習者は該当フラグを手動で True に変更する
2. WHEN フラグが False から True に変更される THEN システムは次回実行時に通常のsolve()実行フローを開始する
3. WHEN モード変更が完了する THEN システムは新しいモードでの実行準備を整える
4. IF フラグ変更後に再実行される THEN システムは変更されたモード設定に従って動作する

### Requirement 5: GUI表示制御機能
**ユーザーストーリー:** 学習者として、初回確認モードでも通常と同様のGUI画面表示を見たい。そうすることで、ステージのレイアウトや要素配置を視覚的に理解できる。

#### 受入条件
1. WHEN 初回確認モードでアプリケーションが起動される THEN システムは通常のGUI画面を描画する  
2. WHEN ステージの描画が完了する THEN システムは一時停止状態を維持する
3. WHILE 初回確認モードで実行されている間 システムはGUI更新を継続する
4. WHEN 初回確認モードでの表示が完了する THEN システムは学習者の次の操作を待機する
5. IF GUI描画エラーが発生した場合 THEN システムはエラー状況を適切に学習者に通知する

### Requirement 6: ハイパーパラメータ統合機能
**ユーザーストーリー:** システム開発者として、既存のHyperParameterManagerシステムと整合性を保ちながら新しいフラグ機能を統合したい。そうすることで、システムの一貫性と保守性を維持できる。

#### 受入条件
1. WHEN 初回確認モードフラグが導入される THEN システムは既存のハイパーパラメータ設定箇所に統合する
2. WHEN main.pyのsolve()直前でハイパーパラメータが設定される THEN システムは新しいフラグも同時に設定する  
3. IF 既存のHyperParameterManagerが使用されている THEN システムは新機能をそのフレームワーク内に実装する
4. WHEN フラグ設定が完了する THEN システムは設定値の妥当性を検証する
5. WHERE パラメータ管理が実行される場所で システムは一貫した設定管理方法を維持する
