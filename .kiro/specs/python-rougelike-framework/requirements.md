# Requirements Document

## Introduction
Python初学者向けローグライク演習フレームワークは、大学初学年の学生がプログラミングをゲーム感覚で学習できる教育システムです。学生は段階的に設計されたローグライク風ステージを、Python APIを使用してプログラム的に攻略し、移動から始まり条件分岐、ループ、攻撃、アイテム取得まで体系的に学習します。

## Project Description (User Input)
docs/v0_1st_plan.md を元に要件定義してください

## Requirements

### Requirement 1: コアゲームエンジン
**User Story:** 教育者として、学生が安定した環境でプログラミング学習できるように、堅牢なゲームエンジンを提供したい

#### Acceptance Criteria
1. WHEN 学生がsolve()関数を実行する THEN システムはゲーム状態を初期化し実行を開始しなければならない
2. IF ゲーム実行中にランタイムエラーが発生した場合 THEN システはエラーを捕捉し、わかりやすい日本語メッセージを表示しなければならない
3. WHEN ゲームが終了状態（成功/失敗/タイムアウト）に達した THEN システムは結果を記録し、実行を安全に終了しなければならない
4. WHILE ゲームが実行中の間 THE システムは全てのアクションを逐次実行し、状態整合性を保たなければならない

### Requirement 2: 学生向けAPI
**User Story:** 学生として、直感的で覚えやすいAPI を使って、段階的にプログラミングスキルを身に付けたい

#### Acceptance Criteria
1. WHEN 学生がturn_left()を呼び出す THEN システムはキャラクターを左に90度回転させなければならない
2. WHEN 学生がturn_right()を呼び出す THEN システムはキャラクターを右に90度回転させなければならない
3. WHEN 学生がmove()を呼び出す THEN システムはキャラクターを正面方向に1マス移動させなければならない
4. IF 移動先に壁や障害物がある場合 THEN システムは移動を拒否し、適切なエラーメッセージを返さなければならない
5. WHEN 学生がattack()を呼び出す THEN システムは正面1マスの敵を攻撃しなければならない
6. WHEN 学生がpickup()を呼び出す THEN システムは足元のアイテムを取得し、自動装備しなければならない
7. WHEN 学生がsee()を呼び出す THEN システムは正面、左右、足元の状況情報を辞書形式で返さなければならない

### Requirement 3: ステージシステム
**User Story:** 教育者として、YAML形式でステージを定義し、学習段階に応じた多様なステージを提供したい

#### Acceptance Criteria
1. WHEN システムが起動する THEN YAMLファイルからステージ定義を読み込み、バリデーションを実行しなければならない
2. IF YAML形式が不正な場合 THEN システムは詳細なエラーメッセージを出力し、読み込みを中断しなければならない
3. WHEN ステージが5x5サイズで定義されている THEN システムは5x5のゲームグリッドを生成しなければならない
4. WHEN ステージが10x10サイズで定義されている THEN システムは10x10のゲームグリッドを生成しなければならない
5. WHERE ステージにプレイヤー開始位置が定義されている THE システムはキャラクターを指定位置・向きで配置しなければならない
6. WHERE ステージに敵・アイテム・ゴールが定義されている THE システムは指定位置に要素を配置しなければならない
7. IF ステージに最大ターン数制限がある場合 THEN システムは制限ターンを超過時にゲームを終了しなければならない

### Requirement 4: 段階的学習システム
**User Story:** 学生として、基礎的な移動から始めて、徐々に複雑な機能を学習できるような段階設計を利用したい

#### Acceptance Criteria
1. WHERE Stage01-03では THE システムは移動(turn/move)のみの機能を提供しなければならない
2. WHERE Stage04-06では THE システムは攻撃機能を追加提供しなければならない
3. WHERE Stage07-08では THE システムはpickup機能とアイテムシステムを追加提供しなければならない
4. WHERE Stage09以降では THE システムは10x10サイズの大型ステージを提供しなければならない
5. WHERE Stage10以降では THE システムは敵AI（巡回・追跡）機能を提供しなければならない
6. WHERE Stage14以降では THE システムは大型敵（2x2, 3x3）と特殊攻撃パターンを提供しなければならない
7. IF 学生が前段階のAPIを使用せずに高度な機能を呼び出した場合 THEN システムは段階的学習を促すメッセージを表示しなければならない

### Requirement 5: デュアル表示システム
**User Story:** 学生として、視覚的なGUIと学習用のCUIを使い分けて、異なる学習スタイルに対応したい

#### Acceptance Criteria
1. WHEN 学生がpygameモードで実行する THEN システムはグラフィカルなゲーム画面を表示しなければならない
2. WHEN 学生がCUIモードで実行する THEN システムはテキストベースのゲーム状況を表示しなければならない
3. WHILE pygameモードで実行中 THE システムはキャラクター、敵、アイテム、壁を視覚的に描画しなければならない
4. WHILE CUIモードで実行中 THE システムは同じゲーム情報を文字記号で表現しなければならない
5. IF 大型敵（2x2, 3x3）が存在する場合 THEN両モードで適切にサイズを表現しなければならない
6. WHEN モード切替が実行される THEN システムは同一のゲームロジックで一貫した動作を提供しなければならない

### Requirement 6: 進捗追跡システム
**User Story:** 教育者として、学生の学習進捗と試行過程を詳細に把握し、指導に活用したい

#### Acceptance Criteria
1. WHEN 学生がステージを実行開始する THEN システムは実行ログの記録を開始しなければならない
2. WHEN ゲームが終了する THEN システムはJSONL形式でログを出力しなければならない
3. WHERE ログ出力には THE システムは学籍番号、ステージID、ターン数、試行回数、結果、コードを含めなければならない
4. IF 学生が遅延提出する場合 THEN システムはPERFORMED_DATE定数から遅延フラグを判定しなければならない
5. WHEN 複数学生で協力作業する THEN システムはCOLLABORATORS定数から共同作業者を記録しなければならない
6. WHERE コード品質評価では THE システムはsolve()関数の論理行数を計測しなければならない
7. IF コードサイズが300行/32KBを超過する場合 THEN システムは保存を拒否しなければならない

### Requirement 7: Google Sheets連携
**User Story:** 教育者として、学生の進捗を一元管理し、クラス全体の学習状況をリアルタイムで把握したい

#### Acceptance Criteria
1. WHEN 学生がログアップロードを実行する THEN システムはGoogle Sheets APIを介してデータを送信しなければならない
2. IF 同一学生が同一ステージを再提出する場合 THEN システムは既存レコードを最新データで上書きしなければならない
3. WHERE レート制限では THE システムは1分あたり最大6件の送信制限を適用しなければならない
4. IF API制限を超過する場合 THEN システムはローカルファイルに一時保存し、後で再送信しなければならない
5. WHEN データをアップロードする THEN システムはステージ別シート（stage01, stage02...）に適切に分類しなければならない
6. WHERE 学内公開設定では THE システムは他学生の進捗参照を可能にしなければならない

### Requirement 8: 環境構築・配布システム
**User Story:** 教育者として、学生が容易に環境を構築し、トラブルなく学習を開始できるようにしたい

#### Acceptance Criteria
1. WHEN プロジェクトを配布する THEN システムはconda環境設定ファイル(env.yml)を含めなければならない
2. WHEN プロジェクトを配布する THEN システムはpip環境設定ファイル(requirements.txt)を併記しなければならない
3. WHERE README.mdには THE システムは段階的なセットアップ手順を日本語で記載しなければならない
4. IF 環境構築でエラーが発生する場合 THEN システムは一般的なトラブルシューティング情報を提供しなければならない
5. WHEN 学生がmain.pyを実行する THEN システムはデフォルトでpygameモードで起動しなければならない
6. WHEN 学生が--cuiオプションを指定する THEN システムはCUIモードで起動しなければならない

### Requirement 9: ランダム生成システム（拡張機能）
**User Story:** 教育者として、学習効果を高めるため、基本ステージ習得後にランダム生成ステージを提供したい

#### Acceptance Criteria
1. WHERE StageR1-R6では THE システムは段階的にランダム生成ステージを提供しなければならない
2. WHEN ランダムステージを生成する THEN システムはクリア可能性を事前検証しなければならない
3. IF 解法が存在しないステージが生成された場合 THEN システムは再生成を実行しなければならない
4. WHERE 難易度調整では THE システムは学習段階に応じた複雑度を維持しなければならない
5. WHEN ランダムステージをクリアする THEN システムは通常ステージと同様にログ記録しなければならない

### Requirement 10: エラーハンドリング・教育支援
**User Story:** 学生として、プログラミングエラーから学習でき、適切なフィードバックを受けたい

#### Acceptance Criteria
1. WHEN 実行時エラーが発生する THEN システムは平易な日本語でエラー内容を説明しなければならない
2. IF 無効な移動を試行した場合 THEN システムは「壁があります」等の具体的メッセージを表示しなければならない
3. WHEN タイムアウトが発生する THEN システムは「制限時間を超過しました」と理由を明示しなければならない
4. WHERE コード品質向上支援では THE システムは冗長なコードに対して改善提案を表示しなければならない
5. IF APIの使用方法が不正な場合 THEN システムは正しい使用例を含む説明を提供しなければならない