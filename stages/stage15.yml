id: stage15
title: 最終ボス複合戦ステージ
description: 3種類の大型敵（2x2・3x3・2x3）が登場する最高難易度ステージです。2x3特殊敵は大型敵を全て撃破することで自動的に消滅します。戦略的思考が試される最終バトルに挑戦しましょう。

board:
  size: [14, 11]
  grid:
    - ".............."
    - ".............."
    - ".............."
    - ".............."
    - ".............."
    - ".............."
    - ".............."
    - ".............."
    - ".............."
    - ".............."
    - ".............."
  legend:
    ".": "empty"
    "P": "player"
    "G": "goal"
    "L": "large_enemy"

player:
  start: [0, 0]
  direction: "E"
  hp: 200
  max_hp: 200
  attack_power: 30

goal:
  position: [13, 10]

enemies:
  - id: "large_2x2_guardian"
    type: "large_2x2"
    position: [8, 2]  # 2x2敵の左上座標（ステージ12と同じ）
    direction: "W"
    hp: 1000
    max_hp: 1000
    attack_power: 1000
    rage_threshold: 0.5
    area_attack_range: 1
    behavior: "stage11_special"
    stage11_special: true

  - id: "titan_guardian"
    type: "large_3x3"
    position: [8, 5]  # 3x3敵の左上座標（ステージ12と同じ）
    direction: "W"
    hp: 2000
    max_hp: 2000
    attack_power: 1000
    rage_threshold: 0.5
    area_attack_range: 2
    behavior: "stage11_special"
    stage11_special: true

  - id: "shadow_lord"
    type: "special_2x3"
    position: [4, 8]  # 2x3敵の左上座標
    direction: "N"
    hp: 10000      # 通常攻撃では倒せない
    max_hp: 10000
    attack_power: 10000  # 触れれば即死
    behavior: "conditional"
    special_conditions:
      auto_eliminate_on_large_enemies_defeated: true  # 大型敵全撃破で自動消滅
      success_effect: "eliminate"  # 条件達成で即座に消滅

items: []

constraints:
  max_turns: 1000
  allowed_apis: ["turn_left", "turn_right", "move", "attack", "pickup", "wait", "see"]

victory_conditions:
  - type: "defeat_all_enemies"
  - type: "reach_goal"

# 学習目標とヒント
learning_objectives:
  - "3種類の大型敵（2x2・3x3・2x3）の形状と占有範囲を理解する"
  - "複数大型敵の同時管理と戦略的攻撃順序を学習する"
  - "怒りモードパターンを活用した撃破メカニズムを習得"
  - "複雑な戦略的思考と長期計画立案能力を養う"
  - "最終ステージにふさわしい総合的なスキル統合とゲーム理解"

hints:
  - "プレイヤーは左上角[0,0]から開始、ゴールは右下角[13,10]です"
  - "2x2大型敵は[8,2]を左上として配置（占有範囲[8,2]～[9,3]）"
  - "3x3大型敵は[8,5]を左上として配置（占有範囲[8,5]～[10,7]）"
  - "2x3影の王は[4,8]を左上として配置（占有範囲[4,8]～[6,10]）北向き"
  - "プレイヤー攻撃力30、2x2敵HP1000（34回攻撃）、3x3敵HP2000（67回攻撃）"
  - "影の王は通常攻撃では倒せません（HP10000, 攻撃力10000）"
  - ""
  - "🤖 2x2・3x3敵の動作解説（ステージ12と同じパターン）:"
  - "  【平常時】HP50%以上では完全に無害 - 移動せず、攻撃せず、追跡しません"
  - "  【怒りモード突入】HP50%を下回り、かつ攻撃を受けた瞬間に発動"
  - "  【3ターン警告】怒りモード突入後、3ターンのカウントダウンを開始"
  - "  【範囲攻撃実行】4ターン目に範囲攻撃を実行（2x2敵=1マス、3x3敵=2マス）"
  - "  【平常復帰】範囲攻撃後は即座に平常時に戻る（再攻撃まで無害）"
  - ""
  - "🗡️ 2x3特殊敵の撃破条件（重要）:"
  - "  【通常攻撃無効】2x3敵には通常のattack()は一切効果なし（HP10000）"
  - "  【監視モード】初期状態では移動・攻撃せず、大型敵の怒りパターンを監視"
  - "  【交互怒りパターン検出】2x2敵怒り→3x3敵怒りの交互パターンを監視"
  - "  【追跡モード発動】交互パターンを守らず大型敵を撃破すると追跡・攻撃開始"
  - "  【自動撃破条件】交互パターン確立後、2x2敵撃破→3x3敵撃破で自動消滅"
  - "  【注意】2x2敵を倒した後は交互パターン判定が停止（3x3撃破で即座に消滅）"
  - ""
  - "⚠️ 実際の攻略手順（重要：交互怒りパターン必須）:"
  - "手順1: 2x2敵を攻撃して怒りモードにする（撃破しない！）"
  - "手順2: 3x3敵を攻撃して怒りモードにする（撃破しない！）"
  - "手順3: 上記を何度か繰り返して交互怒りパターンを確立"
  - "手順4: パターン確立後、2x2敵を完全撃破"
  - "手順5: 最後に3x3敵を完全撃破"
  - "手順6: 2x3敵は自動的に消滅（特別な攻撃は不要）"
  - "⚠️注意: いきなり撃破すると2x3敵が追跡モードになります！"
  - "see()で敵の状態と怒りモードを常に確認しながら進行"
  - "最終ステージ・最高難易度：戦略的思考と忍耐力が試されます！"

# 特殊エラーメッセージとヒント
error_handling:
  wrong_sequence:
    message: "2x3特殊敵への直接攻撃は無効です。大型敵を順次撃破してください。"
    hint: "2x2敵と3x3敵を交互に怒らせるパターンを作ってから順次撃破してください"
  
  direct_attack:
    message: "2x3特殊敵には通常攻撃が効きません。特別な撃破条件があります。" 
    hint: "大型敵（2x2・3x3）を全て倒すと2x3敵は自動的に消滅します"
  
  no_key_attack:
    message: "2x3特殊敵を倒すには大型敵を先に撃破する必要があります。"
    hint: "2x2敵→3x3敵の順序で撃破してください"