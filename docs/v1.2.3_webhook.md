# ローグライク演習フレームワーク v1.2.3 Webhook版 リリースノート

## 🎯 概要

v1.2.3 Webhook版では、**Google Cloud Console不要の完全無料**でGoogle Sheetsにセッションログを共有する機能を提供します。Google Apps Scriptを活用することで、教育現場でのコスト負担なしに学習進捗の可視化を実現します。

## ✨ 新機能（Webhook版）

### 🆓 完全無料のログ共有システム
- **Google Apps Script活用**: 無料のwebhookエンドポイント
- **コスト削減**: Google Cloud Console課金なし
- **簡単セットアップ**: OAuth認証不要
- **教員管理**: 一元的なスプレッドシート管理

### 🎮 学生向け機能
- **シンプル設定**: `python upload_webhook.py --setup` の1回設定
- **即座にアップロード**: `python upload_webhook.py stage01` で完了
- **接続テスト**: `--test` オプションで動作確認
- **統計表示**: アップロード履歴の確認

### 👨‍🏫 教員向け機能
- **5分セットアップ**: Google Apps Scriptの簡単設定
- **自動スプレッドシート作成**: ヘッダー・フィルター自動設定
- **リアルタイム更新**: 学生のアップロード即座に反映
- **カスタマイズ可能**: ログレベル別色分け

## 🏗️ システム構成（Webhook版）

### アーキテクチャ概要
```
┌─────────────────────────────────────────────────────────────┐
│                 Google Apps Script版 v1.2.3                 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────┐    ┌──────────────────┐               │
│  │   学生側        │    │    教員側        │               │
│  │                 │    │                  │               │
│  │ upload_webhook.py│───│ Google Apps      │               │
│  │ (Webhook Client) │   │ Script           │               │
│  └─────────────────┘    └──────────────────┘               │
│           │                        │                        │
│  ┌─────────────────┐    ┌──────────────────┐               │
│  │ セッションログ   │    │ Google Sheets    │               │
│  │ (JSON形式)      │    │ (自動作成)       │               │
│  └─────────────────┘    └──────────────────┘               │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                        コア機能                             │
│                                                             │
│ • WebhookUploader        (HTTP POST送信)                    │
│ • WebhookConfigManager   (設定管理)                         │
│ • SessionLogLoader       (ログファイル読み込み)            │
│ • GoogleAppsScript       (サーバーサイド処理)               │
└─────────────────────────────────────────────────────────────┘
```

### 技術仕様
- **フロントエンド**: Python Webhook クライアント
- **バックエンド**: Google Apps Script (JavaScript)
- **データベース**: Google Sheets (自動作成)
- **認証**: なし（webhookエンドポイントのみ）
- **通信**: HTTPS POST（JSON形式）

## 📋 使用方法

### 🚀 初期セットアップ（教員・5分）

#### Step 1: Google Apps Scriptでwebhook作成

1. **Google Apps Scriptにアクセス**
   ```
   https://script.google.com/
   ```

2. **新しいプロジェクトを作成**
   - 「新しいプロジェクト」をクリック
   - プロジェクト名: 「ローグライク演習ログ受信システム」

3. **コードを貼り付け**
   - `google_apps_script/Code.gs` の内容をコピー
   - エディターに貼り付け、保存

4. **Webアプリとしてデプロイ**
   ```
   「デプロイ」→「新しいデプロイ」
   種類: ウェブアプリ
   実行者: 自分
   アクセス: 全員
   ```

5. **Webhook URL取得**
   ```
   例: https://script.google.com/macros/s/AKfycbxxx.../exec
   ```

#### Step 2: 学生への配布

Webhook URLを学生に配布（メール・掲示板等）

### 📤 ログアップロード（学生・1分）

#### 初回設定（1回のみ）
```bash
python upload_webhook.py --setup
```

質問に答える：
- **Webhook URL**: 教員から提供されたURL
- **学生ID**: 自分の学生ID（例: 123456A）

#### 日常的な使用
```bash
# 特定ステージのログアップロード
python upload_webhook.py stage01

# 全ログアップロード  
python upload_webhook.py --all

# 設定確認
python upload_webhook.py --status

# 接続テスト
python upload_webhook.py --test
```

## 📊 Google Sheetsデータ構造

### 自動作成されるスプレッドシート
- **名前**: 「ローグライク演習_セッションログ」
- **場所**: 教員のGoogle Drive
- **アクセス**: 教員が管理

### データ列
| 列名 | 説明 | 例 |
|------|------|-----|
| 学生ID | 学生識別子 | 123456A |
| セッションID | セッション識別子 | uuid形式 |
| ステージ | 演習ステージ | stage01 |
| 日時 | ログ生成時刻 | 2024/01/01 10:00:00 |
| レベル | ゲーム内レベル | 3 |
| HP | 現在体力 | 80 |
| 最大HP | 最大体力 | 100 |
| 位置X, Y | プレイヤー座標 | 5, 7 |
| スコア | 累計スコア | 250 |
| アクション | 実行した行動 | move, attack |
| ログレベル | メッセージ重要度 | INFO, WARNING, ERROR |

### 自動機能
- **ヘッダー行**: 自動作成・書式設定
- **フィルター**: ヘッダー行に自動設定
- **色分け**: エラーレベル別の行背景色
- **列幅調整**: 内容に応じた自動調整
- **日時形式**: 標準的な日時フォーマット

## 🔧 設定ファイル

### webhook_config.json
```json
{
  "webhook_url": "https://script.google.com/macros/s/YOUR_ID/exec",
  "student_id": "123456A",
  "description": "Google Apps Script Webhookアップロード設定",
  "created_at": "2024-01-01T10:00:00"
}
```

### 設定コマンド
```bash
# 設定確認
python upload_webhook.py --status

# 設定変更
python upload_webhook.py --setup

# 接続テスト
python upload_webhook.py --test
```

## 🛡️ セキュリティ・プライバシー

### データ保護
- **最小限の情報**: 学習に必要な情報のみ送信
- **暗号化通信**: HTTPS通信による保護
- **Googleセキュリティ**: Google社の標準セキュリティ
- **アクセス制御**: 教員のGoogleアカウントで管理

### 送信されるデータ
✅ **含まれる情報**:
- 学生ID、ゲームデータ（HP、スコア等）
- アクションログ、エラー情報

❌ **含まれない情報**:
- 個人名、ソースコード
- システム情報、個人ファイル

## 🧪 テスト

### 接続テスト
```bash
python upload_webhook.py --test
```
**期待結果**: スプレッドシートにテストデータが1行追加

### 実際のログテスト
```bash
# ゲーム実行
python main_stage01.py

# ログアップロード
python upload_webhook.py stage01 --dry-run  # テスト実行
python upload_webhook.py stage01           # 実際にアップロード
```

### エラー処理テスト
```bash
# 無効な設定でテスト
python upload_webhook.py --setup
# 間違ったURLを入力してエラーハンドリングを確認
```

## 🐛 トラブルシューティング

### 教員側の問題

#### 問題1: Google Apps Scriptエラー
**症状**: デプロイ時に権限エラー  
**解決方法**:
```
「詳細設定」→「安全でないページに移動」
必要な権限を承認
```

#### 問題2: スプレッドシートが作成されない
**症状**: ログ送信後もスプレッドシートが見つからない  
**解決方法**:
- Google Apps Scriptの実行ログを確認
- Google Drive APIの権限を確認

### 学生側の問題

#### 問題1: Webhook URL設定エラー
**症状**: 「無効なWebhook URL」エラー  
**解決方法**:
```bash
python upload_webhook.py --setup
# 正しいURL（https://script.google.com/macros/s/...）を入力
```

#### 問題2: 学生ID形式エラー
**症状**: 「無効な学生ID形式」エラー  
**解決方法**:
- 6桁数字+1英字（大文字）: `123456A`
- 小文字や長さ間違いは不可

#### 問題3: アップロード失敗
**症状**: HTTP 500 エラーや接続エラー  
**解決方法**:
```bash
python upload_webhook.py --test  # 接続テスト
python upload_webhook.py --status # 設定確認
```

## 📈 従来版との比較

### Google Cloud Console版 vs Webhook版

| 項目 | Cloud Console版 | **Webhook版** |
|------|-----------------|---------------|
| **費用** | 有料（API使用料） | **🆓 完全無料** |
| **セットアップ** | 複雑（20分） | **🚀 簡単（5分）** |
| **認証** | OAuth2必要 | **✨ 認証不要** |
| **管理** | 個別認証管理 | **👨‍🏫 教員一元管理** |
| **機能** | 高機能 | **📊 必要十分** |

### 推奨用途

**Cloud Console版**: 企業・研究機関での大規模利用  
**Webhook版**: **🎓 教育現場での日常利用（推奨）**

## 🔄 マイグレーション

### Cloud Console版からの移行

#### Step 1: 新しいツールのテスト
```bash
# 既存の upload.py と並行利用可能
python upload_webhook.py --setup
python upload_webhook.py --test
```

#### Step 2: 段階的移行
```bash
# 新版でテストアップロード
python upload_webhook.py stage01 --dry-run

# 実際のアップロード
python upload_webhook.py stage01
```

#### Step 3: 完全移行
- 学生への新しい手順案内
- 既存の認証情報は保持（バックアップとして）

## 💡 活用例

### 教育現場での典型的な使用パターン

#### 1. 授業中リアルタイム確認
```
学生がステージクリア
↓ 
python upload_webhook.py stage01
↓
教員のスプレッドシートに即座に反映
↓
授業中に進捗状況を把握・指導
```

#### 2. 週次進捗レビュー
```
学生が週末に複数ステージを実行
↓
python upload_webhook.py --all
↓
週明けに教員が全体の進捗を確認
↓
個別指導・全体指導の計画
```

#### 3. グループ学習支援
```
スプレッドシートを共有設定
↓
学生同士が進捗を相互確認
↓
協力学習・競争学習の促進
```

## 🎯 今後の予定

### v1.2.4（予定）
- **GUI版アップローダー**: コマンドライン不要の簡単操作
- **バッチアップロード**: 複数ステージの一括処理
- **進捗可視化**: グラフ・チャート機能

### v1.3.0（予定）
- **分析ダッシュボード**: Google Apps Script版統計表示
- **自動レポート**: 週次・月次の自動集計
- **マルチクラス対応**: 複数クラスの統合管理

## 📚 関連ドキュメント

### 教員向け
- [📋 教員向けセットアップガイド](teacher_setup_guide.md)
- [🔧 Google Apps Scriptコード](../google_apps_script/Code.gs)

### 学生向け
- [📖 学生向け使用ガイド](student_guide_webhook.md)
- [❓ よくある質問](faq_webhook.md)

### 技術資料
- [⚙️ Webhook APIリファレンス](webhook_api_reference.md)
- [🧪 テスト仕様書](test_specification_webhook.md)

---

## 🎉 v1.2.3 Webhook版の意義

このバージョンにより、**コスト制約のある教育現場でも**、学習進捗の可視化とリアルタイム共有が可能になりました。

- **🆓 完全無料**: 教育予算への負担なし
- **🚀 簡単導入**: 技術的ハードルの大幅削減  
- **📊 効果的指導**: データに基づく個別指導の実現
- **🎓 学習促進**: 進捗の可視化による学習動機向上

**教育効果と経済性を両立した、理想的な学習支援システムです！** ✨

---

**🎉 v1.2.3 Webhook版リリース: 2024年1月20日**

> 教育現場のために設計された、完全無料で使いやすいログ共有システムです。Google Apps Scriptの活用により、技術的な複雑さを排除し、教育の本質に集中できる環境を提供します。