# v1.2.10 リリースノート: seeチュートリアル体系化・API機能拡張

**Release Date**: 2025-09-20
**Focus**: 包括的チュートリアル体系構築とハードコーディング排除API設計

## 📋 概要

v1.2.10では、`see()`関数と新規追加の`get_stage_info()`APIを中心とした包括的なチュートリアル体系を構築しました。プログラミング初学者から上級者まで対応する段階的学習システムと、ハードコーディングを排除した汎用的なコード設計手法を提供します。

### 🎯 主要成果
- **4つの段階的チュートリアル**による体系的学習環境の構築
- **get_stage_info() API**によるハードコーディング問題の根本解決
- **vision_map機能**による高度な戦略立案支援
- **完全後方互換性**を維持した機能拡張

## 新機能

### 1. see()関数の拡張 - 視界範囲制御

**従来の制限**: 隣接する4セルのみ観測可能（視界範囲1）
**新機能**: vision_rangeパラメータで観測範囲を制御可能

```python
# 使用例
info = see()        # デフォルト視界範囲2（推奨）
info = see(1)       # 狭い視界（隣接セルのみ）
info = see(3)       # 広い視界（より戦略的）
```

#### 視界範囲の効果
- **vision_range=1**: 4セル観測（従来相当）
- **vision_range=2**: 12セル観測（敵の視界と同等、デフォルト）
- **vision_range=3**: 24セル観測（高度な戦略立案が可能）

#### 新しい返却データ構造

```python
{
    "player": {...},              # 従来通り
    "surroundings": {...},        # 従来通り（後方互換性）
    "vision_map": {               # 新機能：視界範囲内の全セル情報
        "1,0": {
            "position": [1, 0],
            "distance": 1,
            "content": "empty"
        },
        "2,1": {
            "position": [2, 1],
            "distance": 2,
            "content": "wall"
        }
        // ... 視界範囲内の全セル
    },
    "items": [...],               # 従来通り
    "enemies": [...],             # 従来通り
    "enemy_visions": [...],       # 従来通り
    "game_status": {...}          # 従来通り
}
```

### 2. get_stage_info() API - ハードコーディング解決

**問題**: チュートリアルでゴール位置等をハードコーディング
**解決**: ステージ情報を動的に取得するAPI

```python
stage_info = get_stage_info()
print(stage_info)
```

#### 返却データ構造

```python
{
    "stage_id": "stage01",
    "board": {
        "size": [5, 5]
    },
    "goal": {
        "position": [4, 4]
    },
    "player": {
        "start_position": [0, 0],
        "max_hp": 100,
        "attack_power": 30
    },
    "constraints": {
        "max_turns": 20,
        "allowed_apis": ["turn_left", "turn_right", "move", "see", "get_stage_info"]
    },
    "metadata": {
        "enemy_count": 0,
        "item_count": 0,
        "wall_count": 1
    }
}
```

### 3. 包括的チュートリアル体系 (docs/see_tutorial/)

プログラミング初学者から上級者まで対応する4段階のチュートリアル体系を構築しました。

#### 3.1 基本API習得 (basic_api.md)
- **対象**: see()関数初学者
- **サイズ**: 353行、実践的API学習
- **内容**: API基本使用法、データ構造理解、get_stage_info()活用
- **学習時間**: 30-45分

#### 3.2 シンプルアルゴリズム実践 (simple_algorithm.md)
- **対象**: 具体的アルゴリズム実装を学ぶ方
- **サイズ**: 522行、Stage01特化実装
- **内容**: 確実クリア手法、段階的実装、障害物回避ロジック
- **学習時間**: 45-60分

#### 3.3 汎用的プレイヤー構築 (general_purpose.md)
- **対象**: 複数ステージ対応の高度実装を目指す方
- **サイズ**: 1620行、構造化設計
- **内容**: 汎用アルゴリズム、エラーハンドリング、改善手法
- **学習時間**: 90-120分

#### 3.4 API完全リファレンス (see_description.md)
- **対象**: API詳細仕様を知りたい方
- **サイズ**: 414行、v1.2.10対応仕様書
- **内容**: 全データ構造、新機能解説、デバッグ手法
- **学習時間**: 20-30分

#### 学習システムの特徴
- **段階的学習**: 基礎→実践→応用→参照の4段階構成
- **実行可能コード**: 全コード例が動作確認済み
- **ハードコーディング排除**: get_stage_info()による動的設計
- **教育的配慮**: プログラミング初学者向けの丁寧な解説

## 技術的改善

### API Layer拡張

1. **get_stage_info()メソッド追加**
   - ファイル: `engine/api.py`
   - 機能: ステージの基本情報を構造化して返却
   - ターン消費: なし（情報取得のみ）

2. **see()メソッド拡張**
   - 新パラメータ: `vision_range: int = 2`
   - 新フィールド: `vision_map`
   - 後方互換性: 従来の`surroundings`フィールドを維持

3. **ヘルパーメソッド追加**
   - `_get_cell_info()`: セル情報の統一取得

### Stage Configuration更新

1. **Stage01設定更新**
   - ファイル: `stages/stage01.yml`
   - 追加API: `get_stage_info`

2. **Stage Loader拡張**
   - ファイル: `engine/stage_loader.py`
   - 有効APIリストに`get_stage_info`を追加

### Global API関数拡張

```python
# 拡張されたグローバル関数
def see(vision_range: int = 2) -> Dict[str, Any]:
    """周囲の状況を確認（視界範囲指定可能）"""

def get_stage_info() -> Dict[str, Any]:
    """ステージの基本情報を取得"""
```

## 破壊的変更

**なし** - 完全後方互換性を維持

- 既存の`see()`呼び出しは引き続き動作（デフォルト視界範囲2で拡張）
- 既存の返却データ構造（`surroundings`等）は維持
- 既存のコードは変更不要

## 使用例の比較

### 従来の方法（非推奨）
```python
# ハードコーディング
goal_pos = [4, 4]

# 限定的な観測
info = see()  # 隣接4セルのみ
```

### 新しい方法（推奨）
```python
# 動的取得
stage_info = get_stage_info()
goal_pos = stage_info["goal"]["position"]

# 戦略的観測
info = see(2)  # 敵と同等の視界範囲
vision_map = info["vision_map"]

# 特定座標の確認
if "2,1" in vision_map:
    cell_content = vision_map["2,1"]["content"]
```

## パフォーマンス影響

- **see()**: vision_range増加に比例して計算量増加
  - vision_range=1: 4セル処理
  - vision_range=2: 12セル処理（+8セル）
  - vision_range=3: 24セル処理（+12セル）
- **get_stage_info()**: 軽量（ゲーム状態読み取りのみ）

## 教育効果

### 初心者向け改善
1. **戦略的思考の促進**: 広い視界による高度な計画立案
2. **ハードコーディング問題の解決**: 動的データ取得の重要性を学習
3. **API設計の理解**: 構造化データの扱い方を実践

### 学習段階の最適化
1. **基礎**: see()の基本的な使い方
2. **実践**: Stage01での具体的な適用
3. **応用**: 他ステージでの汎用的な考え方

## 今後の拡張性

### API拡張の基盤
- vision_rangeパラメータパターンは他APIでも適用可能
- get_stage_info()は他ステージ情報の取得にも拡張可能

### チュートリアル体系
- 他API（attack, pickup等）の類似チュートリアル作成の基盤
- 段階的学習システムのテンプレート確立

## 検証済み環境

- **Python**: 3.9.23
- **ステージ**: stage01.yml
- **テスト**: 全34コード例の動作確認
- **互換性**: 既存機能との完全互換性確認

## 🗂️ ファイル構成

### 新規作成ファイル
```
docs/see_tutorial/
├── README.md                 # 学習ガイド・チュートリアル一覧
├── basic_api.md             # API基礎習得（353行）
├── simple_algorithm.md      # Stage01特化アルゴリズム（522行）
├── general_purpose.md       # 汎用プレイヤー構築（1620行）
└── see_description.md       # API完全リファレンス（414行）
```

### 更新ファイル
- `engine/api.py` - get_stage_info()追加、see()拡張
- `main.py` - get_stage_info import追加
- `docs/tutorial_see.md` - 新体系への誘導ページに変更
- `docs/v1.2.10.md` - このリリースノート
- `README.md` - v1.2.10対応更新

### 保護ファイル
- `main_*.py` - 学習者編集ファイル（.gitignore対象）
- `stages/generated_*.yml` - 生成ステージファイル（.gitignore対象）
- `stages/stage*.yml` - 基本ステージ定義は変更なし
- 既存チュートリアル - 独立性維持

## 🔄 ハードコーディング排除の成果

### 従来の問題
```python
# ❌ ハードコーディング（従来）
goal_pos = [4, 4]           # Stage01専用
max_turns = 20              # 固定値
board_size = [5, 5]         # 決め打ち
```

### v1.2.10での解決
```python
# ✅ 動的取得（v1.2.10）
stage_info = get_stage_info()
goal_pos = stage_info["goal"]["position"]
max_turns = stage_info["constraints"]["max_turns"]
board_size = stage_info["board"]["size"]

# 汎用的API使用チェック
if "attack" in stage_info["constraints"]["allowed_apis"]:
    attack()  # 攻撃可能ステージでのみ実行
```

## 📚 教育効果の向上

### プログラミング思考の育成
1. **問題分析**: ステージ構造の動的理解
2. **アルゴリズム設計**: 複数アプローチの比較検討
3. **構造化プログラミング**: 関数分割と責任分離
4. **汎用性**: ハードコーディング回避による拡張性

### 学習パス推奨
```
初心者: basic_api.md → simple_algorithm.md → Stage01実践 → general_purpose.md
経験者: basic_api.md → general_purpose.md → simple_algorithm.md（比較）
```

## 🚀 今後の展開

### 学習効果の検証
- 各チュートリアルの学習効果測定
- プログラミング初学者の理解度向上確認
- ハードコーディング回避設計の浸透度評価

### 機能拡張予定
- 他API（attack, pickup, wait）の詳細チュートリアル作成
- より高度なステージでの応用例追加
- アルゴリズム理論（A*, BFS, DFS）との連携

### 技術的発展方向
1. **視界システムの統一**: 敵とプレイヤーの視界システム統合
2. **パフォーマンス最適化**: 大型ステージでの視界計算効率化
3. **UI改善**: vision_mapの視覚的表示機能

## 🏷️ バージョン情報

- **リリース日**: 2025年9月20日
- **主な変更**: get_stage_info()追加、see()機能拡張、チュートリアル体系化
- **互換性**: v1.2.9以前との完全後方互換
- **推奨移行**: 既存ユーザーは段階的移行を推奨

---

**重要**: このバージョンはプログラミング教育の質的向上を目的とした重要なアップデートです。ハードコーディングからの脱却と汎用的設計思考の習得により、より実践的なプログラミングスキルの向上が期待されます。

**開発者メモ**: 「初心者でも戦略的にプレイできる環境」の構築を主眼とし、教育効果と技術的改善のバランスを重視。4つのチュートリアルによる体系的学習環境により、プログラミング教育フレームワークとしての価値を大幅に向上させました。