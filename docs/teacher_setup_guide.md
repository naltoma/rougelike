# 📋 教員向けセットアップガイド - Google Apps Script版

## 🎯 概要

このガイドは、ローグライク演習フレームワーク v1.2.3 の Google Apps Script版セッションログ共有機能を設定するための教員向け手順書です。

**⏰ 所要時間**: 約5-10分  
**💰 費用**: 完全無料  
**🔧 必要なもの**: Googleアカウント

---

## 📖 目次

1. [Google Apps Scriptの設定](#1-google-apps-scriptの設定)
2. [Webhookの公開設定](#2-webhookの公開設定)
3. [学生への案内](#3-学生への案内)
4. [動作確認](#4-動作確認)
5. [トラブルシューティング](#5-トラブルシューティング)

---

## 1. Google Apps Scriptの設定

### Step 1-1: Google Apps Scriptにアクセス

1. **Googleアカウントでログイン**
   - [Google Apps Script](https://script.google.com/) にアクセス
   - 普段使用しているGoogleアカウントでログイン

2. **新しいプロジェクトを作成**
   - 「新しいプロジェクト」をクリック
   - プロジェクト名を「ローグライク演習ログ受信システム」に変更

### Step 1-2: コードの貼り付け

1. **既存のコードを削除**
   ```javascript
   function myFunction() {
     
   }
   ```
   ↑このコードを全て削除

2. **新しいコードを貼り付け**
   - `google_apps_script/Code.gs` の内容を全てコピー
   - エディターに貼り付け
   - `Ctrl+S` (Windows) / `Cmd+S` (Mac) で保存

### Step 1-3: 権限の確認

初回保存時に以下の権限が要求される場合があります：
- **Google Sheets API**: スプレッドシート作成・編集
- **Google Drive API**: ファイル検索・作成

**「承認」をクリックして権限を付与してください。**

---

## 2. Webhookの公開設定

### Step 2-1: デプロイの実行

1. **「デプロイ」ボタンをクリック**
   - 右上の「デプロイ」→「新しいデプロイ」を選択

2. **デプロイタイプの選択**
   - 「種類を選択」→「ウェブアプリ」を選択

3. **実行設定**
   ```
   説明: ローグライク演習ログ受信システム v1.2.3
   次のユーザーとして実行: 自分（your-email@gmail.com）
   アクセスできるユーザー: 全員
   ```

4. **「デプロイ」をクリック**

### Step 2-2: Webhook URLの取得

デプロイ完了後、以下のような画面が表示されます：

```
✅ デプロイが成功しました

Webhook URL: 
https://script.google.com/macros/s/AKfycbxxxxxxxxxxxxxxxxxxxxx/exec
```

**⚠️ 重要: このURLを大切に保管してください**

---

## 3. 学生への案内

### Step 3-1: 学生向けセットアップ手順の作成

以下の情報を学生に伝えてください：

```
📢 学生の皆さんへ - ローグライク演習ログ共有設定

1. 以下のコマンドを実行してください：
   python upload_webhook.py --setup

2. 表示される質問に答えてください：
   - Webhook URL: https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec
   - 学生ID: あなたの学生ID（例: 123456A）

3. 設定完了後、以下でテストしてください：
   python upload_webhook.py --test

4. ステージ完了後、ログをアップロードしてください：
   python upload_webhook.py stage01

✅ 設定が完了すると、先生がリアルタイムで進捗を確認できます！
```

### Step 3-2: よくある質問（FAQ）

**Q: 学生IDの形式は？**  
A: 6桁の数字 + 1文字のアルファベット（例: 123456A）

**Q: エラーが出た場合は？**  
A: `python upload_webhook.py --status` で設定状態を確認し、先生に報告してください

**Q: 何度もアップロードできる？**  
A: はい。同じステージを何度でもアップロード可能です

---

## 4. 動作確認

### Step 4-1: 接続テスト

1. **ブラウザでWebhook URLにアクセス**
   - デプロイ時に取得したURLをブラウザで開く
   - 以下のような画面が表示されればOK：

   ```
   🎮 ローグライク演習フレームワーク v1.2.3
   ✅ Webhookエンドポイントは正常に動作しています
   📊 現在のスプレッドシート: ローグライク演習_セッションログ
   ```

2. **Google Driveの確認**
   - Google Driveに「ローグライク演習_セッションログ」スプレッドシートが自動作成される
   - ヘッダー行（学生ID、ステージ、日時など）が設定される

### Step 4-2: 実際のログテスト

学生に以下のテストを実行してもらいます：

```bash
# 接続テスト
python upload_webhook.py --test
```

成功すると、スプレッドシートにテストデータが1行追加されます。

---

## 5. トラブルシューティング

### 🔧 よくある問題と解決方法

#### 問題1: デプロイ時に権限エラー

**症状**: 「このアプリは確認されていません」エラー  
**解決方法**:
1. 「詳細設定」をクリック
2. 「安全でないページに移動」をクリック
3. 権限を承認

#### 問題2: スプレッドシートが作成されない

**症状**: ログを送信してもスプレッドシートが見つからない  
**解決方法**:
1. Google Apps Scriptの実行ログを確認
2. 「実行」→「実行の詳細」でエラーメッセージを確認
3. Google Driveの権限を再確認

#### 問題3: 学生からの接続エラー

**症状**: `python upload_webhook.py --test` が失敗  
**解決方法**:
1. Webhook URLが正しいか確認
2. デプロイ設定で「アクセスできるユーザー: 全員」になっているか確認
3. Google Apps Scriptが正しく保存されているか確認

#### 問題4: データが重複する

**症状**: 同じログが何度も記録される  
**解決方法**:
- 現在の仕様では同じログの重複送信を許可しています
- 必要に応じて重複削除のロジックを追加可能

---

## 📊 スプレッドシートの見方

### 列の説明

| 列名 | 説明 | 例 |
|------|------|-----|
| 学生ID | 学生識別子 | 123456A |
| セッションID | セッション識別子 | uuid形式 |
| ステージ | 演習ステージ | stage01 |
| 日時 | ログ生成時刻 | 2024/01/01 10:00:00 |
| レベル | ゲーム内レベル | 3 |
| HP | 現在体力/最大体力 | 80/100 |
| 位置X, Y | プレイヤー座標 | 5, 7 |
| スコア | 累計スコア | 250 |
| アクション | 実行した行動 | move, attack |
| ログレベル | メッセージ重要度 | INFO, WARNING, ERROR |

### 自動機能

- **色分け**: エラーレベルに応じた行の背景色
- **フィルター**: ヘッダー行にフィルター機能
- **自動列幅**: 内容に応じた列幅調整
- **日時形式**: 日時の自動フォーマット

---

## 🔐 セキュリティについて

### データの取り扱い

- **個人情報**: 学生IDのみ記録（氏名等は記録されません）
- **アクセス制御**: スプレッドシートは教員のGoogleアカウントで作成
- **データ保存**: Google Drive内に保存（Google社のセキュリティに準拠）

### 推奨セキュリティ設定

1. **スプレッドシートの共有設定**
   - 必要に応じて共有範囲を制限
   - 「編集者」権限は信頼できる人のみに付与

2. **定期的な確認**
   - 不要なログデータの削除
   - Webhook URLの定期的な変更（必要に応じて）

---

## 🚀 高度な設定（オプション）

### カスタマイズ可能な項目

Google Apps Scriptコードの先頭部分で以下を変更可能：

```javascript
// スプレッドシート名の変更
const SPREADSHEET_NAME = 'あなたの好きな名前';

// 記録する項目の変更
const HEADER_ROW = [
  // 必要な項目のみに絞ることも可能
];
```

### 複数クラスの管理

複数のクラスやコースがある場合：
1. クラス毎に異なるGoogle Apps Scriptプロジェクトを作成
2. または、1つのスプレッドシートで複数のシートタブを使用

---

## 📞 サポート

### 質問・要望について

- **技術的な問題**: システム管理者に相談
- **機能要望**: 開発チームにフィードバック
- **操作方法**: このガイドを参照

### 更新情報

このシステムのアップデート情報は以下で確認できます：
- リリースノート: `docs/v1.2.3.md`
- 変更履歴: Git履歴

---

**🎉 セットアップ完了お疲れ様でした！**

これで学生の演習進捗をリアルタイムで確認できる環境が整いました。何かご不明な点がございましたら、お気軽にお問い合わせください。